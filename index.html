<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bit√°cora de Juntas y Vendedores</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --pendiente: #e67e22; --listo: #27ae60; --azul: #2980b9; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7f9; margin: 0; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 3px solid var(--azul); padding-bottom: 10px; }
        h1 { margin: 0; color: #2c3e50; font-size: 1.5rem; }
        .btn-refresh { background: var(--azul); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-refresh:hover { background: #1a5a80; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .card-header { background: var(--azul); color: white; padding: 12px; text-align: center; font-weight: bold; text-transform: uppercase; font-size: 0.9rem; }
        .content { padding: 15px; min-height: 100px; }
        .task { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; flex-direction: column; }
        .task:last-child { border-bottom: none; }
        .task-name { font-weight: 500; color: #333; margin-bottom: 5px; }
        .status-badge { display: inline-block; font-size: 0.7rem; padding: 3px 8px; border-radius: 10px; font-weight: bold; width: fit-content; }
        .status-pendiente { background: #fff3e0; color: var(--pendiente); border: 1px solid var(--pendiente); }
        .status-listo { background: #e8f5e9; color: var(--listo); border: 1px solid var(--listo); text-decoration: none !important; }
        .is-done { text-decoration: line-through; color: #95a5a6 !important; }
    </style>
</head>
<body>

    <header>
        <h1>üìã PANEL DE SEGUIMIENTO LUNES</h1>
        <button class="btn-refresh" onclick="loadData()">üîÑ Actualizar Datos</button>
    </header>

    <div id="loading" style="text-align:center; padding: 50px;">Cargando pendientes...</div>
    <div class="grid" id="mainGrid"></div>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTsePMc9flpt7FS7INMvVH4drQZAlpG96AqFOV7iQ0q2WO7g1H28MBM2SDkUN31gmY5agCDP4VoZrwx/pub?gid=0&single=true&output=csv';

        // Mapeo exacto de tus columnas
        const estructura = [
            { t: "JUNTAS SEMANALES", s: "ESTATUS1" },
            { t: "TULANCINGO", s: "ESTATUS2" },
            { t: "CECI P.", s: "ESTATUS3" },
            { t: "ENRIQUE R.", s: "ESTATUS4" },
            { t: "OSCAR F.", s: "ESTATUS5" },
            { t: "CELENE S.", s: "ESTATUS6" }
        ];

        function loadData() {
            document.getElementById('mainGrid').innerHTML = "";
            document.getElementById('loading').style.display = "block";
            
            // A√±adimos un timestamp para evitar que el navegador guarde una copia vieja (cache)
            const fetchUrl = csvUrl + "&cachebust=" + new Date().getTime();

            Papa.parse(fetchUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    render(results.data);
                    document.getElementById('loading').style.display = "none";
                }
            });
        }

        function render(data) {
            const grid = document.getElementById('mainGrid');
            
            estructura.forEach(col => {
                let card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<div class="card-header">${col.t}</div>`;
                
                let content = document.createElement('div');
                content.className = 'content';
                
                let hasData = false;

                data.forEach(row => {
                    // Limpiar nombres de columnas de espacios invisibles
                    const rowClean = {};
                    Object.keys(row).forEach(k => rowClean[k.trim().toUpperCase()] = row[k]);

                    let tarea = rowClean[col.t.toUpperCase()];
                    let rawStatus = rowClean[col.s.toUpperCase()] || "";
                    let estatus = rawStatus.trim().toUpperCase();

                    if (tarea && tarea.trim().length > 0) {
                        hasData = true;
                        // Lista de palabras que significan "LISTO"
                        const terminosExito = ["LISTO", "OK", "CUMPLIDO", "HECHO", "TERMINADO", "X"];
                        let isDone = terminosExito.includes(estatus);

                        content.innerHTML += `
                            <div class="task">
                                <span class="task-name ${isDone ? 'is-done' : ''}">${tarea}</span>
                                <span class="status-badge ${isDone ? 'status-listo' : 'status-pendiente'}">
                                    ${isDone ? '‚úì ' + estatus : '‚è≥ PENDIENTE'}
                                </span>
                            </div>
                        `;
                    }
                });

                if (!hasData) content.innerHTML = `<p style="color:#ccc; text-align:center; font-size:0.8rem;">Sin pendientes</p>`;
                
                card.appendChild(content);
                grid.appendChild(card);
            });
        }

        window.onload = loadData;
    </script>
</body>
</html>
